{% extends "base.html" %}
{% block content %}
  <section class="card">
    <h2>Create License</h2>
    <form method="post" action="/licenses/new" class="grid-2">
      <label>User name <input name="user_name" required/></label>
      <label>User email <input name="user_email" type="email" required/></label>
      <label>Module <input name="module_name" required/></label>
      <label>Max machines <input type="number" min="1" max="50" name="max_machines" value="2"/></label>
      <label>Expires at (optional, ISO 8601)
        <input name="expires_at" placeholder="YYYY-MM-DDTHH:MM:SS"/>
      </label>
      <div></div>
      <button type="submit">Create</button>
    </form>
  </section>

  <section class="card">
    <h2>Licenses</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Key</th><th>User</th><th>Email</th><th>Module</th>
          <th>Max</th><th>Expires</th><th>Revoked</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for l in licenses %}
        <tr>
          <td><code>{{ l.license_key }}</code></td>
          <td>{{ l.user_name }}</td>
          <td>{{ l.user_email }}</td>
          <td>{{ l.module_name }}</td>
          <td>{{ l.max_machines }}</td>
          <td>{{ l.expires_at or "-" }}</td>
          <td>{{ "yes" if l.revoked else "no" }}</td>
          <td>
            {% if not l.revoked %}
            <form method="post" action="/licenses/revoke" onsubmit="return confirm('Revoke license?');">
              <input type="hidden" name="license_key" value="{{ l.license_key }}"/>
              <button type="submit">Revoke</button>
            </form>
            {% else %}-{% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}
